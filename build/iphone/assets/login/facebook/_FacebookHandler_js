function FacebookHandler(){var e={},i=require("com.facebook");i.permissions=["public_profile","user_friends","email"];var t=Ti.Network.createHTTPClient({onload:function(){Ti.API.info("Received text: "+this.responseText);var e=JSON.parse(this.responseText);-1!=e.return?global.startApplication():alert("Error!")},onerror:function(e){Ti.API.debug(e.error)},timeout:5e3});return i.addEventListener("login",function(e){if(e.success){if(Ti.API.info("login success: "+JSON.stringify(e.data)),Titanium.App.Properties.getBool("user_logged")){var n=Titanium.UI.createImageView({image:"https://graph.facebook.com/"+e.data.id+"/picture?width=500&height=500",width:500,height:500}),r=Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,"profile_name.png");r.write(n.toBlob()),Ti.API.info(n.image),Titanium.App.Properties.setBool("user_logged",1),Titanium.App.Properties.setString("fb_id",e.data.id),Titanium.App.Properties.setString("fb_last_name",e.data.last_name),Titanium.App.Properties.setString("fb_first_name",e.data.first_name),Titanium.App.Properties.setString("fb_mail",e.data.email),Ti.API.info("Actual permissions: "+JSON.stringify(i.permissions));var s={id:e.data.id,locale:e.data.locale,gender:e.data.gender,email:e.data.email,first_name:e.data.first_name,last_name:e.data.last_name,region:"not_yet"};Ti.API.info(s),t.open("GET",global.bangServerUrl+"/user-registerUser.php?user_account="+JSON.stringify(s)),t.send()}}else e.cancelled?Ti.API.info("login cancelled"):e.error&&Ti.API.info(e.error)}),i.addEventListener("logout",function(e){Ti.API.info(JSON.stringify(e))}),e.logMeIn=function(){i.authorize()},e.getInvitableFriends=function(){i.authorize(),i.requestWithGraphPath("me/friends",{fields:"installed,name,id"},"GET",function(e){e.success?(Ti.API.info("request result Get Friends"+JSON.stringify(e.result.data)),Ti.App.fireEvent("friends_done",{data:JSON.stringify(e.result.data)})):alert(e.error?e.error:"Unknown response")})},e.getInvitableFriendsForChart=function(){i.authorize(),i.requestWithGraphPath("me/friends",{fields:"installed,name,id"},"GET",function(e){if(e.success){Ti.API.info("request result Get Friends"+JSON.stringify(e.result.data));var i=JSON.parse(e.result.data),t={name:Ti.App.Properties.getString("fb_first_name")+" "+Ti.App.Properties.getString("fb_last_name"),id:Ti.App.Properties.getString("fb_id")};return i.push(t),i}alert(e.error?e.error:"Unknown response")})},i.initialize(6e3,!0),e.logMeOut=function(){i.logout()},e}module.exports=FacebookHandler;