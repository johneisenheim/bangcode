function FacebookHandler(){var e={},i=require("facebook");i.permissions=["public_profile","user_friends","email"];var t=Ti.Network.createHTTPClient({onload:function(){Ti.API.info("Received text: "+this.responseText);var e=JSON.parse(this.responseText);-1!=e.return?global.startApplication():alert("Error!")},onerror:function(e){Ti.API.debug(e.error)},timeout:5e3});return i.addEventListener("login",function(e){if(e.success){var i=JSON.parse(e.data);if(!Titanium.App.Properties.getBool("user_logged")){var n=Titanium.UI.createImageView({image:"https://graph.facebook.com/"+i.id+"/picture?width=500&height=500",width:500,height:500}),s=Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,"profile_name.png");s.write(n.toBlob()),Ti.API.info(n.image),Titanium.App.Properties.setBool("user_logged",1),Titanium.App.Properties.setString("fb_id",i.id),Titanium.App.Properties.setString("fb_last_name",i.last_name),Titanium.App.Properties.setString("fb_first_name",i.first_name),Titanium.App.Properties.setString("fb_mail",e.data.email);var o={id:i.id,locale:i.locale,gender:i.gender,email:i.email,first_name:i.first_name,last_name:i.last_name,region:"null"};Ti.API.info(o),t.open("GET",global.bangServerUrl+"/user-registerUser.php?user_account="+JSON.stringify(o)),t.send()}}else e.cancelled?Ti.API.info("login cancelled"):e.error&&Ti.API.info(e.error)}),i.addEventListener("logout",function(e){e.success?(Titanium.App.Properties.removeProperty("user_logged"),Titanium.App.Properties.removeProperty("fb_id"),Titanium.App.Properties.removeProperty("fb_last_name"),Titanium.App.Properties.removeProperty("fb_first_name"),Titanium.App.Properties.removeProperty("fb_mail")):e.cancelled?Ti.API.info("login cancelled"):e.error&&Ti.API.info(e.error)}),e.getInvitableFriends=function(){i.getLoggedIn()?(Ti.API.info("App is still logged, I'm getting cached login session."),i.initialize(5e3)):(Ti.API.info("App is authorizing..."),i.authorize()),i.requestWithGraphPath("me/friends",{fields:"installed,name,id"},"GET",function(e){Ti.API.info("e is "+JSON.stringify(e));var i=JSON.parse(e.result);e.success?(Ti.API.info("request result Get Friends"+JSON.stringify(i.data)),Ti.App.fireEvent("friends_done",{data:JSON.stringify(i.data)})):alert(e.error?e.error:"Unknown response")})},e.getInvitableFriendsForChart=function(){i.initialize(5e3),i.requestWithGraphPath("me/friends",{fields:"installed,name,id"},"GET",function(e){if(e.success){var i=JSON.parse(e.result),t={name:Ti.App.Properties.getString("fb_first_name")+" "+Ti.App.Properties.getString("fb_last_name"),id:Ti.App.Properties.getString("fb_id")};return i.push(t),i}alert(e.error?e.error:"Unknown response")})},e.logMeIn=function(){i.getLoggedIn()?(Ti.API.info("App is still logged, I'm getting cached login session."),i.initialize(5e3)):(Ti.API.info("App is authorizing..."),i.authorize())},e}module.exports=FacebookHandler;