function QuickGameFinder(e){function t(){0==l?(Ti.API.info("countdown BANG!"),w.stop(),clearInterval(s),setTimeout(function(){startTime=new Date,I.play(),Ti.App.fireEvent("user_can_fire",{})},300)):(Ti.API.info(l),l-=1)}function i(){s=setInterval(t,1e3)}var o=null,n=null,a="notready",r=0,l=0,s=null;amITheMaster=0;var d=!1,c=require("ui/quickGame/QuickGameFinderView"),u=new c,m=null,T=null,p=!0,h=require("ui/customUI/Loader"),f=new h,g=require("ui/customUI/Loader2"),v=new g,I=ZLSound.createSample({media:"music/bell.mp3",volume:1}),w=ZLSound.createSample({media:"music/tic.mp3",volume:1}),S=Titanium.UI.createWindow({navTintColor:"white",tintColor:"#E2BB5A",barColor:"#E2BB5A",extendEdges:[Ti.UI.EXTEND_EDGE_TOP],backgroundColor:"#F5F4F2",translucent:!0,statusBarStyle:Titanium.UI.iPhone.StatusBar.GRAY,layout:"composite",tabBarHidden:!0,modal:!0,orientationModes:[1]}),y=Titanium.UI.createLabel({top:"55%",font:{fontSize:18,fontFamily:"Roboto-LightItalic"},text:"Controllo Bluetooth...",textAlign:"center",color:"#aa938b",width:"95%"}),b=Titanium.UI.createButton({title:"Chiudi",font:{fontSize:19},color:"#856C64",top:20,right:15}),A=Ti.UI.createAlertDialog({ok:"Okay",title:"Bang!"}),E=function(){o=require("com.pj"),n=o.createSession();n.checkBluetoothAccess();n.addEventListener("bluetoothState",function(e){switch(e.state){case"The connection with the system service was momentarily lost, update imminent.":break;case"The platform doesn't support Bluetooth Low Energy.":A.message="Il tuo dispositivo non supporta il bluetooth 4.0. Bang! non può funzionare su questi dispositivi.",A.show(),y.text="Bluetooth non supportato.",o=null,n=null;break;case"The app is not authorized to use Bluetooth Low Energy.":A.message="Non hai autorizzato Bang! a poter utilizzare il bluetooth.",A.show(),y.text="Bluetooth non autorizzato.",o=null,n=null;break;case"Bluetooth is currently powered off.":A.message="Il Bluetooth è spento! Per favore, accedi alle impostazioni e attivalo.",A.show(),y.text="Il Bluetooth è spento.";break;case"Bluetooth is currently powered on and available to use.":y.text="Ricerco la partita...",n.setupSessionAndStartServices(Ti.App.Properties.getString("fb_id"),"",0),d=!0}}),n.addEventListener("didReceiveInvitationFromPeer",function(){y.text="Ho trovato la partita!Preparo il gioco..."}),n.addEventListener("connecting",function(){y.text="Connetto allo sfidante..."}),n.addEventListener("connected",function(){y.text="Connesso! Iniziamo...",setTimeout(function(){e?v.hideLoader(S):f.hideLoader(S),S.remove(y),u.initialize(),S.add(u)},2e3)}),n.addEventListener("notConnected",function(){Ti.API.info("Ho lanciato il notConnected")}),n.addEventListener("didReceiveData",function(e){var t=e.message.split(":");switch(t[0]){case"tellme":a=u.getMyOwnStatus()?"ready":"notready",Ti.API.info("[INFO] Sending "+a);try{n.sendData(a+":")}catch(o){Ti.API.info("Telepathy status in tellme case in didreceivedata")}break;case"start":l=3+parseInt(r),Ti.API.info("[INFO] Counter is "+l),i(),w.play();break;case"random":r=t[1];break;case"youWin":n.stopServices(),setTimeout(function(){var e=require("ui/winlose/Win"),t=new e(S);t.setLabelText("Hai vinto. Il tuo tempo è "+myTime+"ms e il tempo dell'avversario è "+vsTime),S.remove(T),S.add(t),t.playSound()},2500);break;case"youLoose":n.stopServices(),setTimeout(function(){var e=require("ui/winlose/Lose"),t=new e(S);t.setLabelText(999999999==myTime?"Hai mancato il tuo avversario! Aggiusta la mira, gringo!":"Hai perso. Il tuo tempo è "+myTime+"ms e il tempo dell'avversario è "+vsTime),S.remove(T),S.add(t),t.playSound()},2500);break;case"draw":n.stopServices();var d=require("ui/winlose/Lose"),c=new d(S);c.setLabelText("Avete perso entrambi...Impara bene gringo, rischi la pelle nel vecchio west!"),setTimeout(function(){S.remove(T),S.add(c),c.playSound()},2500);break;case"times":if(vsTime=t[1],888888888==vsTime){clearInterval(s),w.stop(),m=require("ui/winlose/Calculating"),T=new m;var p=null;null!=u&&(p=u.getMotionObject(),u.removeEventOnOrientation(),p.stopMotionRecognizer(),S.remove(u)),S.add(T);var h=require("ui/winlose/Win"),f=new h(S);f.setLabelText("Hai vinto! Il tuo avversario ha sparato per primo. Avrà mica voluto barare?"),setTimeout(function(){S.remove(T),S.add(f),f.playSound()},2500)}else if(0!=myTime)try{n.sendData("calculate:"+myTime)}catch(o){Ti.API.info("calculate in times case in didreceivedata")}}})};S.addEventListener("open",E),b.addEventListener("click",function(){S.close()}),Ti.App.addEventListener("timeExchange",function(e){if(p){p=!1,Ti.API.info("timeExchange");try{n.sendData("acceleration:"+e.acceleration)}catch(t){Ti.API.info("Telepathy acceleration timeExchange")}m=require("ui/winlose/Calculating"),T=new m;var i=null;if(null!=u&&(i=u.getMotionObject(),u.removeEventOnOrientation(),i.stopMotionRecognizer(),S.remove(u)),S.add(T),999999999==e.flag){myTime=e.flag;try{n.sendData("times:"+e.flag)}catch(t){Ti.API.info("Telepathy times timeExchange")}}else if(888888888==e.flag){Ti.API.info("flag is 888888888"),clearInterval(s),w.stop(),myTime=e.flag;try{n.sendData("times:"+e.flag)}catch(t){Ti.API.info("Telepathy times timeExchange")}var o=require("ui/winlose/Lose"),a=new o(S);a.setLabelText("Ehi gringo, attento! Hai sparato troppo presto!"),setTimeout(function(){S.remove(T),S.add(a),a.playSound()},2500)}else{myTime=diffTime;try{n.sendData("times:"+diffTime)}catch(t){Ti.API.info("Telepathy times timeExchange else")}}}}),S.add(y),S.add(b),e||f.showLoader(S);var L=function(){Ti.API.info("closing window..."),n.stopServices(),o=null,n=null,myTime=0,vsTime=0,startTime=0,endTime=0,diffTime=0,u.deallocModule(),u=null,c=null};return S.addEventListener("close",L),S.addEventListener("focus",function(){Ti.API.info("FOCUS"),e&&v.showLoader(S)}),Ti.App.addEventListener("resume",function(){Ti.API.info("resumed"),f.hideLoader(S),f.showLoader(S)}),S}module.exports=QuickGameFinder;