function QuickGameFinder(){function e(){0==r?(Ti.API.info("countdown BANG!"),h.stop(),clearInterval(l),setTimeout(function(){startTime=new Date,T.play(),Ti.App.fireEvent("user_can_fire",{})},300)):(Ti.API.info(r),r-=1)}function t(){l=setInterval(e,1e3)}var i=null,o=null,n="notready",a=0,r=0,l=null,s=require("ui/quickGame/QuickGameFinderView"),d=new s,u=null,c=null,m=!0,T=ZLSound.createSample({media:"music/bell.mp3",volume:1}),h=ZLSound.createSample({media:"music/tic.mp3",volume:1}),g=Titanium.UI.createWindow({navTintColor:"white",tintColor:"#E2BB5A",barColor:"#E2BB5A",extendEdges:[Ti.UI.EXTEND_EDGE_TOP],backgroundColor:"#F5F4F2",translucent:!0,statusBarStyle:Titanium.UI.iPhone.StatusBar.GRAY,layout:"composite",tabBarHidden:!0,modal:!0,orientationModes:[1]}),f=Titanium.UI.createLabel({top:"55%",font:{fontSize:18,fontFamily:"Roboto-LightItalic"},text:"Controllo Bluetooth...",textAlign:"center",color:"#aa938b",width:"95%"}),p=Titanium.UI.createButton({title:"Chiudi",font:{fontSize:19},color:"#856C64",top:20,right:15}),I=Ti.UI.createAlertDialog({ok:"Okay",title:"Bang!"});loader.showLoader(g);var w=function(){i=require("com.pj"),o=i.createSession();o.checkBluetoothAccess();o.addEventListener("bluetoothState",function(e){switch(e.state){case"The connection with the system service was momentarily lost, update imminent.":break;case"The platform doesn't support Bluetooth Low Energy.":I.message="Il tuo dispositivo non supporta il bluetooth 4.0. Bang! non può funzionare su questi dispositivi.",I.show(),f.text="Bluetooth non supportato.",i=null,o=null;break;case"The app is not authorized to use Bluetooth Low Energy.":I.message="Non hai autorizzato Bang! a poter utilizzare il bluetooth.",I.show(),f.text="Bluetooth non autorizzato.",i=null,o=null;break;case"Bluetooth is currently powered off.":I.message="Il Bluetooth è spento! Per favore, accedi alle impostazioni e attivalo.",I.show(),f.text="Il Bluetooth è spento.";break;case"Bluetooth is currently powered on and available to use.":f.text="Ricerco la partita...",o.setupSessionAndStartServices(Ti.App.Properties.getString("fb_id"),"",0)}}),o.addEventListener("didReceiveInvitationFromPeer",function(){f.text="Ho trovato la partita!Preparo il gioco..."}),o.addEventListener("connecting",function(){f.text="Connetto allo sfidante..."}),o.addEventListener("connected",function(){f.text="Connesso! Iniziamo...",setTimeout(function(){loader.hideLoader(g),g.remove(f),d.initialize(),g.add(d)},2e3)}),o.addEventListener("notConnected",function(){Ti.API.info("Ho lanciato il notConnected")}),o.addEventListener("didReceiveData",function(e){var i=e.message.split(":");switch(i[0]){case"tellme":n=d.getMyOwnStatus()?"ready":"notready",Ti.API.info("[INFO] Sending "+n),o.sendData(n+":");break;case"start":r=3+parseInt(a),Ti.API.info("[INFO] Counter is "+r),t(),h.play();break;case"random":a=i[1];break;case"fault":h.stop(),clearInterval(l),myTime=0,vsTime=888888888;var s=d.getMotionObject();s.stopMotionRecognizer();var u=require("ui/winlose/Win"),m=new u(g);m.setLabelText("Hai vinto!"),g.add(m),m.playSound();break;case"youWin":setTimeout(function(){var e=require("ui/winlose/Win"),t=new e(g);t.setLabelText("Hai vinto. Il tuo tempo è "+myTime+" e il tempo dell'avversario è "+vsTime),g.remove(c),g.add(t),t.playSound()},2500);break;case"youLoose":setTimeout(function(){var e=require("ui/winlose/Lose"),t=new e(g);t.setLabelText("Hai perso. Il tuo tempo è "+myTime+" e il tempo dell'avversario è "+vsTime),g.remove(c),g.add(t),t.playSound()},2500);break;case"times":vsTime=i[1],0!=myTime&&o.sendData("calculate:"+myTime)}})};return Ti.App.addEventListener("fault",function(){clearInterval(l),h.stop(),o.sendData("fault:")}),g.addEventListener("open",w),p.addEventListener("click",function(){o.stopServices(),i=null,o=null,g.close()}),Ti.App.addEventListener("timeExchange",function(e){if(m){if(o.sendData("acceleration:"+e.acceleration),999999999==e.flag||88888888==e.flag){myTime=e.flag;try{o.sendData("times:"+e.flag)}catch(t){}}else{myTime=diffTime;try{o.sendData("times:"+diffTime)}catch(t){}}u=require("ui/winlose/Calculating"),c=new u,d.removeEventOnOrientation(),g.remove(d),g.add(c),m=!1}}),g.add(f),g.add(p),g.addEventListener("close",function(){Ti.API.info("closing window..."),o.stopServices(),i=null,o=null,myTime=0,vsTime=0,startTime=0,endTime=0,diffTime=0,d.deallocModule(),d=null,s=null}),g}module.exports=QuickGameFinder;