function QuickGameFinder(){function e(){0==r?(Ti.API.info("countdown BANG!"),h.stop(),clearInterval(l),setTimeout(function(){startTime=new Date,p.play(),Ti.App.fireEvent("user_can_fire",{})},300)):(Ti.API.info(r),r-=1)}function t(){l=setInterval(e,1e3)}var i=null,o=null,n="notready",a=0,r=0,l=null;amITheMaster=0;var s=!1,d=require("ui/quickGame/QuickGameFinderView"),c=new d,u=null,m=null,T=!0,p=ZLSound.createSample({media:"music/bell.mp3",volume:1}),h=ZLSound.createSample({media:"music/tic.mp3",volume:1}),f=Titanium.UI.createWindow({navTintColor:"white",tintColor:"#E2BB5A",barColor:"#E2BB5A",extendEdges:[Ti.UI.EXTEND_EDGE_TOP],backgroundColor:"#F5F4F2",translucent:!0,statusBarStyle:Titanium.UI.iPhone.StatusBar.GRAY,layout:"composite",tabBarHidden:!0,modal:!0,orientationModes:[1]}),g=Titanium.UI.createLabel({top:"55%",font:{fontSize:18,fontFamily:"Roboto-LightItalic"},text:"Controllo Bluetooth...",textAlign:"center",color:"#aa938b",width:"95%"}),v=Titanium.UI.createButton({title:"Chiudi",font:{fontSize:19},color:"#856C64",top:20,right:15}),I=Ti.UI.createAlertDialog({ok:"Okay",title:"Bang!"});loader.showLoader(f);var w=function(){i=require("com.pj"),o=i.createSession();o.checkBluetoothAccess();o.addEventListener("bluetoothState",function(e){switch(e.state){case"The connection with the system service was momentarily lost, update imminent.":break;case"The platform doesn't support Bluetooth Low Energy.":I.message="Il tuo dispositivo non supporta il bluetooth 4.0. Bang! non può funzionare su questi dispositivi.",I.show(),g.text="Bluetooth non supportato.",i=null,o=null;break;case"The app is not authorized to use Bluetooth Low Energy.":I.message="Non hai autorizzato Bang! a poter utilizzare il bluetooth.",I.show(),g.text="Bluetooth non autorizzato.",i=null,o=null;break;case"Bluetooth is currently powered off.":I.message="Il Bluetooth è spento! Per favore, accedi alle impostazioni e attivalo.",I.show(),g.text="Il Bluetooth è spento.";break;case"Bluetooth is currently powered on and available to use.":g.text="Ricerco la partita...",o.setupSessionAndStartServices(Ti.App.Properties.getString("fb_id"),"",0),s=!0}}),o.addEventListener("didReceiveInvitationFromPeer",function(){g.text="Ho trovato la partita!Preparo il gioco..."}),o.addEventListener("connecting",function(){g.text="Connetto allo sfidante..."}),o.addEventListener("connected",function(){g.text="Connesso! Iniziamo...",setTimeout(function(){loader.hideLoader(f),f.remove(g),c.initialize(),f.add(c)},2e3)}),o.addEventListener("notConnected",function(){Ti.API.info("Ho lanciato il notConnected")}),o.addEventListener("didReceiveData",function(e){var i=e.message.split(":");switch(i[0]){case"tellme":n=c.getMyOwnStatus()?"ready":"notready",Ti.API.info("[INFO] Sending "+n);try{o.sendData(n+":")}catch(s){Ti.API.info("Telepathy status in tellme case in didreceivedata")}break;case"start":r=3+parseInt(a),Ti.API.info("[INFO] Counter is "+r),t(),h.play();break;case"random":a=i[1];break;case"youWin":o.stopServices(),setTimeout(function(){var e=require("ui/winlose/Win"),t=new e(f);t.setLabelText("Hai vinto. Il tuo tempo è "+myTime+"ms e il tempo dell'avversario è "+vsTime),f.remove(m),f.add(t),t.playSound()},2500);break;case"youLoose":o.stopServices(),setTimeout(function(){var e=require("ui/winlose/Lose"),t=new e(f);t.setLabelText(999999999==myTime?"Hai mancato il tuo avversario! Aggiusta la mira, gringo!":"Hai perso. Il tuo tempo è "+myTime+"ms e il tempo dell'avversario è "+vsTime),f.remove(m),f.add(t),t.playSound()},2500);break;case"draw":o.stopServices();var d=require("ui/winlose/Lose"),T=new d(f);T.setLabelText("Avete perso entrambi...Impara bene gringo, rischi la pelle nel vecchio west!"),setTimeout(function(){f.remove(m),f.add(T),T.playSound()},2500);break;case"times":if(vsTime=i[1],888888888==vsTime){clearInterval(l),h.stop(),u=require("ui/winlose/Calculating"),m=new u;var p=null;null!=c&&(p=c.getMotionObject(),c.removeEventOnOrientation(),p.stopMotionRecognizer(),f.remove(c)),f.add(m);var g=require("ui/winlose/Win"),v=new g(f);v.setLabelText("Hai vinto! Il tuo avversario ha sparato per primo. Avrà mica voluto barare?"),setTimeout(function(){f.remove(m),f.add(v),v.playSound()},2500)}else if(0!=myTime)try{o.sendData("calculate:"+myTime)}catch(s){Ti.API.info("calculate in times case in didreceivedata")}}})};f.addEventListener("open",w),v.addEventListener("click",function(){f.close()}),Ti.App.addEventListener("timeExchange",function(e){if(T){T=!1,Ti.API.info("timeExchange");try{o.sendData("acceleration:"+e.acceleration)}catch(t){Ti.API.info("Telepathy acceleration timeExchange")}u=require("ui/winlose/Calculating"),m=new u;var i=null;if(null!=c&&(i=c.getMotionObject(),c.removeEventOnOrientation(),i.stopMotionRecognizer(),f.remove(c)),f.add(m),999999999==e.flag){myTime=e.flag;try{o.sendData("times:"+e.flag)}catch(t){Ti.API.info("Telepathy times timeExchange")}}else if(888888888==e.flag){Ti.API.info("flag is 888888888"),clearInterval(l),h.stop(),myTime=e.flag;try{o.sendData("times:"+e.flag)}catch(t){Ti.API.info("Telepathy times timeExchange")}var n=require("ui/winlose/Lose"),a=new n(f);a.setLabelText("Ehi gringo, attento! Hai sparato troppo presto!"),setTimeout(function(){f.remove(m),f.add(a),a.playSound()},2500)}else{myTime=diffTime;try{o.sendData("times:"+diffTime)}catch(t){Ti.API.info("Telepathy times timeExchange else")}}}}),f.add(g),f.add(v);var S=function(){Ti.API.info("closing window..."),o.stopServices(),i=null,o=null,myTime=0,vsTime=0,startTime=0,endTime=0,diffTime=0,c.deallocModule(),c=null,d=null};return f.addEventListener("close",S),f}module.exports=QuickGameFinder;