function QuickGameFinder(){function e(){0==r?(Ti.API.info("countdown BANG!"),u.stop(),c.play(),Ti.App.fireEvent("user_can_fire",{}),clearInterval(l)):(Ti.API.info("[INFO] _countdown "+r),r-=1)}function t(){l=setInterval(function(){Ti.API.info("called startCountdown"),e()},1e3)}var i=null,o=null,n="notready",a=0,r=0,l=null,s=require("ui/quickGame/QuickGameFinderView"),d=new s,c=ZLSound.createSample({media:"music/bell.mp3",volume:1}),u=ZLSound.createSample({media:"music/tic.mp3",volume:1}),h=Titanium.UI.createWindow({navTintColor:"white",tintColor:"#E2BB5A",barColor:"#E2BB5A",extendEdges:[Ti.UI.EXTEND_EDGE_TOP],backgroundColor:"#F5F4F2",translucent:!0,statusBarStyle:Titanium.UI.iPhone.StatusBar.GRAY,layout:"composite",tabBarHidden:!0,modal:!0,orientationModes:[1]}),g=Titanium.UI.createLabel({top:"55%",font:{fontSize:18,fontFamily:"Roboto-LightItalic"},text:"Controllo Bluetooth...",textAlign:"center",color:"#aa938b",width:"95%"}),T=Titanium.UI.createButton({title:"Chiudi",font:{fontSize:19},color:"#856C64",top:20,right:15}),m=Ti.UI.createAlertDialog({ok:"Okay",title:"Bang!"});loader.showLoader(h);var p=function(){i=require("com.pj"),o=i.createSession();o.checkBluetoothAccess();o.addEventListener("bluetoothState",function(e){switch(e.state){case"The connection with the system service was momentarily lost, update imminent.":break;case"The platform doesn't support Bluetooth Low Energy.":m.message="Il tuo dispositivo non supporta il bluetooth 4.0. Bang! non può funzionare su questi dispositivi.",m.show(),g.text="Bluetooth non supportato.",i=null,o=null;break;case"The app is not authorized to use Bluetooth Low Energy.":m.message="Non hai autorizzato Bang! a poter utilizzare il bluetooth.",m.show(),g.text="Bluetooth non autorizzato.",i=null,o=null;break;case"Bluetooth is currently powered off.":m.message="Il Bluetooth è spento! Per favore, accedi alle impostazioni e attivalo.",m.show(),g.text="Il Bluetooth è spento.";break;case"Bluetooth is currently powered on and available to use.":g.text="Ricerco la partita...",o.setupSessionAndStartServices(Ti.App.Properties.getString("fb_id"),"",0)}}),o.addEventListener("didReceiveInvitationFromPeer",function(){g.text="Ho trovato la partita!Preparo il gioco..."}),o.addEventListener("connecting",function(){g.text="Connetto allo sfidante..."}),o.addEventListener("connected",function(){g.text="Connesso! Iniziamo...",setTimeout(function(){loader.hideLoader(h),h.remove(g),h.add(d)},2e3)}),o.addEventListener("notConnected",function(){Ti.API.info("Ho lanciato il notConnected")}),o.addEventListener("didReceiveData",function(e){var i=e.message.split(":");switch(i[0]){case"tellme":n=d.getMyOwnStatus()?"ready":"notready",Ti.API.info("[INFO] Sending "+n),o.sendData(n+":");break;case"start":r=3+parseInt(a),Ti.API.info("[INFO] Counter is "+r),t(),u.play();break;case"random":a=i[1]}})};return h.addEventListener("open",p),T.addEventListener("click",function(){i=null,o=null,h.close()}),h.add(g),h.add(T),h}module.exports=QuickGameFinder;