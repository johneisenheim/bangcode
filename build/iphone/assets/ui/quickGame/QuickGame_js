function QuickGame(){function e(){0==r?(Ti.API.info("countdown BANG!"),c.stop(),s.play(),Ti.App.fireEvent("user_can_fire",{}),clearInterval(l)):(Ti.API.info(r),r-=1)}function t(){l=setInterval(function(){Ti.API.info("called startCountdown"),e()},1e3)}var i=require("com.pj"),o=null,n=require("ui/quickGame/QuickGameView"),a=new n,r=0,l=null,d=Math.floor(4*Math.random()+1),s=ZLSound.createSample({media:"music/bell.mp3",volume:1}),c=ZLSound.createSample({media:"music/tic.mp3",volume:1}),u=0,h=Titanium.UI.createWindow({navTintColor:"white",tintColor:"#E2BB5A",barColor:"#E2BB5A",extendEdges:[Ti.UI.EXTEND_EDGE_TOP],backgroundColor:"#F5F4F2",translucent:!0,statusBarStyle:Titanium.UI.iPhone.StatusBar.GRAY,layout:"composite",tabBarHidden:!0,modal:!0,orientationModes:[1]}),g=Titanium.UI.createLabel({top:"55%",font:{fontSize:17,fontFamily:"Roboto-LightItalic"},text:"Cerco l'avversario...",textAlign:"center",color:"#aa938b",width:"95%"});loader.showLoader(h);var T=function(){Ti.API.info("initQuickGameCallback"),o=i.createSession();o.checkBluetoothAccess();o.addEventListener("bluetoothState",function(e){switch(e.state){case"The connection with the system service was momentarily lost, update imminent.":break;case"The platform doesn't support Bluetooth Low Energy.":dialog.message="Il tuo dispositivo non supporta il bluetooth 4.0. Bang! non può funzionare su questi dispositivi.",dialog.show(),g.text="Bluetooth non supportato.",i=null,o=null;break;case"The app is not authorized to use Bluetooth Low Energy.":dialog.message="Non hai autorizzato Bang! a poter utilizzare il bluetooth.",dialog.show(),g.text="Bluetooth non autorizzato.",i=null,o=null;break;case"Bluetooth is currently powered off.":dialog.message="Il Bluetooth è spento! Per favore, accedi alle impostazioni e attivalo.",dialog.show(),g.text="Il Bluetooth è spento.";break;case"Bluetooth is currently powered on and available to use.":g.text="Ricerco l'avversario...",Ti.API.info(u),o.setupSessionAndStartServices(Ti.App.Properties.getString("fb_id"),u,1)}}),o.addEventListener("connecting",function(){g.text="Connetto allo sfidante..."}),o.addEventListener("connected",function(){g.text="Connesso! Iniziamo...",setTimeout(function(){loader.hideLoader(h),h.remove(g),h.add(a),o.sendData("tellme:"),o.sendData("random:"+d)},2e3)}),o.addEventListener("notConnected",function(){o.tryToReconnect(Ti.App.Properties.getString("fb_id"),u,1)}),o.addEventListener("didReceiveData",function(e){var i=e.message.split(":");switch(Ti.API.info("[INFO] RECEIVED MESSAGE : "+i[0]),i[0]){case"notready":o.sendData("tellme:");break;case"ready":Ti.API.info("Can I send Start packet? "+a.canISendStartPacket()),a.canISendStartPacket()?(o.sendData("start:"),r=3+d,c.play(),t()):o.sendData("tellme:")}})};return h.setIDOpponent=function(e){Ti.API.info("Opponent ID is "+e),u=e},h.addEventListener("open",T),h.add(g),h}module.exports=QuickGame;