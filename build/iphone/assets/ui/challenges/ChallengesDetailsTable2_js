function ChallengesDetailsTable2(){var e=require("ui/customUI/VeryBigTile"),t=new e;t.initialize("tileTitle",15,19);var i=require("ui/customUI/PageTitle"),n=new i;n.initialize("Duello",75);var a=require("ui/challenges/MapToSet"),o=new a,r=require("ui/customUI/MinusNormalTile"),l=new r,s=new r,d=require("ui/customUI/CustomButton"),c=new d;c.initialize("Mostra mappa",40,18);var u=require("ui/customUI/CustomDisabledButton"),m=new u;m.initialize("Negozia",40,18);var f=new d;f.initialize("Accetta",10,18);var p=require("ui/challenges/Picker"),T=new p,h=null,g=null,I=null,w=null,A=!1,v={gennaio:"01",febbraio:"02",marzo:"03",aprile:"04",maggio:"05",giugno:"06",luglio:"07",agosto:"08",settembre:"09",ottobre:"10",novembre:"11",dicembre:"12"},b=Titanium.UI.createWindow({navTintColor:"white",tintColor:"#E2BB5A",barColor:"#E2BB5A",extendEdges:[Ti.UI.EXTEND_EDGE_TOP],backgroundColor:"#F5F4F2",translucent:!0,statusBarStyle:Titanium.UI.iPhone.StatusBar.LIGHT_CONTENT,layout:"composite",backButtonTitle:String.format(L("main:back"),""),tabBarHidden:!0}),y=Titanium.UI.createScrollView({width:"100%",height:"100%",backgroundColor:"#F5F4F2",layout:"vertical"}),S=(Titanium.UI.createLabel({text:"",top:15,font:{fontSize:24,fontFamily:"Roboto-Light"},textAlign:"center",color:"#856C64",width:"95%"}),Titanium.UI.createButton({title:"Rifiuta richiesta",font:{fontSize:21},color:"#856C64",top:10}));return S.addEventListener("click",function(){var e=Ti.UI.createAlertDialog({cancel:1,buttonNames:["Si, ho troppa paura","No, voglio duellare"],message:"Sei sicuro di voler rifiutare la richiesta di duello?",title:"Rifiuta Duello"});e.show(),e.addEventListener("click",function(e){if(e.index!==e.source.cancel){loader.showLoader(b);var t=Ti.Network.createHTTPClient({onload:function(){Ti.API.info("Received text: "+this.responseText);var e=JSON.parse(this.responseText);Ti.API.info(e.return),"0"===e.return?(loader.hideLoader(b),Ti.API.info("ok"),Ti.App.fireEvent("reload",{}),setTimeout(function(){b.close()},1e3)):(loader.hideLoader(b),alert("Error"))},onerror:function(e){loader.hideLoader(b),Ti.API.debug(e.error)},timeout:5e3}),i={id:h};Ti.API.info(JSON.stringify(i)),t.open("GET",global.bangServerUrl+"/challenge-rejectChallenge.php?id_challenge="+JSON.stringify(i)),t.send()}})}),b.initialize=function(e){var i=e.challenge_date;Ti.API.info(i);var n=i.split(" "),a=n[0].split("-"),o=n[1].split(":");year=a[0],month=a[1],day=a[2],hours=o[0],minutes=o[1],seconds=o[2],latitude=e.latitude,longitude=e.longitude,h=e.id,g=new Date(year,month-1,day,hours,minutes,seconds),t.setTitle(e.title+" nei paraggi di "+e.address+" il giorno "+day+"-"+month+"-"+year+" alle ore "+hours+":"+minutes),l.initialize("Negozia data e/o ora",35,18),s.initialize("Negozia la posizione",7,18)},f.addEventListener("click",function(){if(f.canFire){var e=Ti.UI.createAlertDialog({cancel:1,buttonNames:["Si, accetto","Ci ho ripensato"],message:"Sei sicuro di voler accettare il duello?",title:"Accetta Duello"});e.show(),e.addEventListener("click",function(e){if(e.index!==e.source.cancel){loader.showLoader(b);var t=Ti.Network.createHTTPClient({onload:function(){Ti.API.info("Received text: "+this.responseText);var e=JSON.parse(this.responseText);Ti.API.info(e.return),"0"===e.acceptDuels&&"0"===e.getChallenge&&"0"===e.insertChurchbell?(loader.hideLoader(b),Ti.API.info("ok"),Ti.App.fireEvent("reload",{}),setTimeout(function(){b.close()},1e3)):(loader.hideLoader(b),"-1"===e.acceptDuels&&alert("acceptDuels"),"-1"===e.getChallenge&&alert("getChallenge"),"-1"===e.insertChurchbell&&alert("insertChurchbell"))},onerror:function(e){loader.hideLoader(b),Ti.API.debug(e.error)},timeout:5e3}),i={id:h};Ti.API.info(JSON.stringify(i)),t.open("GET",global.bangServerUrl+"/challenge-acceptChallenge.php?challenge="+JSON.stringify(i)),t.send()}})}}),l.addEventListener("click",function(){T.setDate(g),T.customShow()}),m.addEventListener("click",function(){if(m.isEnabled){loader.showLoader(b);var e=Ti.Network.createHTTPClient({onload:function(){Ti.API.info("Received text: "+this.responseText);var e=JSON.parse(this.responseText);Ti.API.info(e.return),"0"===e.return?(Ti.API.info("ok"),Ti.App.fireEvent("reload",{}),loader.hideLoader(b),setTimeout(function(){b.close()},1e3)):("-1"===e.acceptDuels&&alert("acceptDuels"),"-1"===e.getChallenge&&alert("getChallenge"),"-1"===e.insertChurchbell&&alert("insertChurchbell"))},onerror:function(e){Ti.API.debug(e.error)},timeout:5e3}),t={id:h,id_player:Ti.App.Properties.getString("fb_id")};if(A?(t.latitude=I,t.longitude=w):(t.latitude="",t.longitude=""),dataIsChanged){var i=l.getTitle(),n=i.split(" ");t.challenge_date="("+n[2]+"-"+v[n[1]]+"-"+n[0]+" "+n[3]+":00)"}else t.challenge_date="";Ti.API.info(JSON.stringify(t)),e.open("GET",global.bangServerUrl+"/challenge-negotiateChallenge.php?challenge="+JSON.stringify(t)),e.send()}}),Ti.App.addEventListener("close_second_picker",function(e){dataIsChanged=!0,l.setTitle(e.date),m.enable(),f.disable()}),Ti.App.addEventListener("location_choosen",function(e){A=!0,s.setTitle("Posizione impostata"),I=e.latitude,w=e.longitude,m.enable(),f.disable()}),s.addEventListener("click",function(){o.open()}),y.add(n),y.add(t),y.add(l),y.add(s),y.add(m),y.add(f),y.add(S),b.add(y),b.add(T),b}module.exports=ChallengesDetailsTable2;