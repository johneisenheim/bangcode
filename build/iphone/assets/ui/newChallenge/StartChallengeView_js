function StartChallengeView(){var e=require("ui/newChallenge/Picker"),t=(new e,require("ui/customUI/PageTitle")),i=new t;i.initialize("Duello",10);var n=require("ui/customUI/NormalTile"),o=new n;o.initialize(String.format(L("duels:whenInstruction"),""),10,18);var a=new n;a.initialize(String.format(L("duels:whereInstruction"),""),10,18);var r=new n;r.initialize(String.format(L("duels:challengerInstruction"),""),10,18);var l,s,d=require("ui/customUI/CustomButton"),u=new d,c=!1,T=null,m=null,h=Ti.UI.createAlertDialog({ok:"Okay",title:"Bang!"}),g={gennaio:"01",febbraio:"02",marzo:"03",aprile:"04",maggio:"05",giugno:"06",luglio:"07",agosto:"08",settembre:"09",ottobre:"10",novembre:"11",dicembre:"12"},f="",p=Titanium.UI.createScrollView({backgroundColor:"#F5F4F2",width:Ti.UI.SIZE,height:Ti.UI.SIZE,layout:"vertical",top:60}),I=Titanium.UI.createLabel({top:5,font:{fontSize:21,fontFamily:"Roboto-Light"},text:String.format(L("duels:chooseWhen"),""),textAlign:"center",color:"#856C64",width:"95%"}),w=Titanium.UI.createLabel({top:5,font:{fontSize:17,fontFamily:"Roboto-LightItalic"},text:"L'ora che imposti sarà calcolata con un intorno di 3 minuti prima e dopo la scadenza per permettere più flessibilità ai partecipanti.",textAlign:"center",color:"#aa938b",width:"95%"}),b=Titanium.UI.createLabel({top:25,font:{fontSize:21,fontFamily:"Roboto-Light"},text:String.format(L("duels:chooseWhere"),""),textAlign:"center",color:"#856C64",width:"95%"}),v=Titanium.UI.createLabel({top:5,font:{fontSize:17,fontFamily:"Roboto-LightItalic"},text:"La posizione che determini sarà calcolata con un raggio di 100 mt rispetto al marker che inserirai sulla mappa.",textAlign:"center",color:"#aa938b",width:"95%"}),S=Titanium.UI.createLabel({top:25,font:{fontSize:21,fontFamily:"Roboto-Light"},text:String.format(L("duels:chooseChallenger"),""),textAlign:"center",color:"#856C64",width:"95%"}),A=Titanium.UI.createLabel({top:5,font:{fontSize:17,fontFamily:"Roboto-LightItalic"},text:"La lista mostrerà i tuoi amici di Facebook che utilizzano Bang! sul proprio dispositivo.",textAlign:"center",color:"#aa938b",width:"95%"}),E={cancel:4,options:["Quick game","Tra 10 minuti","Tra un'ora","Scegli data","Annulla"],title:"Imposta data"},y=Titanium.UI.createView({width:1,height:15,backgroundColor:"#F5F4F2"}),C=Ti.UI.createOptionDialog(E);return C.addEventListener("click",function(e){switch(e.index){case 0:c=!0,o.setTitle("Quick Game"),a.disable();break;case 1:var t=new Date;t.setMinutes(t.getMinutes()+10);var i=t.toLocaleTimeString(),n=i.split(":");o.setTitle(t.toLocaleDateString()+" "+n[0]+":"+n[1]),a.enable(),c=!1;break;case 2:var t=new Date;t.setHours(t.getHours()+1);var i=t.toLocaleTimeString(),n=i.split(":");o.setTitle(t.toLocaleDateString()+" "+n[0]+":"+n[1]),a.enable(),c=!1;break;case 3:C.hide(),Ti.App.fireEvent("show_picker",{}),a.enable(),c=!1}}),o.addEventListener("click",function(){C.show()}),a.addEventListener("click",function(){if(!c){if(Ti.App.fireEvent("close_picker",{}),!Titanium.Network.getOnline()){var e=Ti.UI.createAlertDialog({message:"Il tuo dispositivo sembra non essere connesso ad Internet.",ok:"Okay",title:"Network"});return void e.show()}var t=require("ui/newChallenge/Map"),i=new t;i.open()}}),r.addEventListener("click",function(){if(Ti.App.fireEvent("close_picker",{}),!Titanium.Network.getOnline()){var e=Ti.UI.createAlertDialog({message:"Il tuo dispositivo sembra non essere connesso ad Internet.",ok:"Okay",title:"Network"});return void e.show()}var t=require("ui/newChallenge/FacebookFriends"),i=new t;i.open()}),u.initialize("Conferma",40),p.getDateFromPicker=function(e){o.setTitle(e)},u.addEventListener("click",function(){var e=Ti.UI.createAlertDialog({title:"Crea Duello",message:"Per inserire un duello, devi inserire tutte le informazioni!",ok:"Ho capito"});if(o.getTitle()===String.format(L("duels:whenInstruction"),""))return void e.show();if(c)T=require("ui/quickGame/QuickGame"),m=new T,m.setIDOpponent(f),Ti.API.info(f),m.open({modal:!0,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_COVER_VERTICAL,modalStyle:Ti.UI.iPhone.MODAL_PRESENTATION_FORMSHEET});else{loader.showLoader(p);var t=o.getTitle(),i=t.split(" "),n=Ti.Network.createHTTPClient({onload:function(){Ti.API.info("Received text: "+this.responseText);var e=JSON.parse(this.responseText);if(loader.hideLoader(p),0==e.return){h.message="Duello registrato!";var t=i[3].split(":");Ti.API.info(t);var n=t[0];Ti.API.info(n);var o=t[1];o-=5;var a=g[i[1]],r=new Date(i[2],a-1,i[0],n,o,0,0);Ti.App.iOS.scheduleLocalNotification({alertBody:"Un nuovo duello ti aspetta!",badge:1,sound:"music/notification.mp3",userInfo:{id:e.last_id},date:r,category:"DUEL",timezone:"CET"}),Ti.API.info(r.toLocaleString()),h.show(),Ti.App.fireEvent("back",{})}else-2==e.return?(h.message="Inserisci un orario che sia superiore di 15 minuti rispetto all'ultimo inserito!",h.show()):(h.message="Pare ci sia stato un problema. Riprova!",h.show())},onerror:function(e){Ti.API.debug(e.error),loader.hideLoader(p)},timeout:5e3}),a={player_one:Ti.App.Properties.getString("fb_id"),player_two:f,latitude:l,longitude:s,challenge_date:"("+i[2]+"-"+g[i[1]]+"-"+i[0]+" "+i[3]+":00)"};Ti.API.info(JSON.stringify(a)),n.open("GET",global.bangServerUrl+"/challenge-registerChallenge.php?challenge="+JSON.stringify(a)),n.send()}}),Ti.App.addEventListener("friend_choosen",function(e){r.setTitle(e.who),f=e.id}),Ti.App.addEventListener("location_choosen",function(e){a.setTitle("Posizione impostata"),l=e.latitude+"",s=e.longitude+""}),Ti.App.addEventListener("reloadMasterView",function(){e=null,t=null;var e=require("ui/quickGame/QuickGame"),t=new e;t.setIDOpponent(f),Ti.API.info(f),t.open({modal:!0,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_COVER_VERTICAL,modalStyle:Ti.UI.iPhone.MODAL_PRESENTATION_FORMSHEET})}),p.add(i),p.add(I),p.add(o),p.add(w),p.add(b),p.add(a),p.add(v),p.add(S),p.add(r),p.add(A),p.add(u),p.add(y),p}module.exports=StartChallengeView;