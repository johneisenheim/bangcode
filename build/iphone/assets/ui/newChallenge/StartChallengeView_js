function StartChallengeView(){var e=require("ui/newChallenge/Picker"),t=(new e,require("ui/customUI/PageTitle")),i=new t;i.initialize("Duello",10);var o=require("ui/customUI/NormalTile"),n=new o;n.initialize(String.format(L("duels:whenInstruction"),""),10,18);var a=new o;a.initialize(String.format(L("duels:whereInstruction"),""),10,18);var r=new o;r.initialize(String.format(L("duels:challengerInstruction"),""),10,18);var l,d,s=require("ui/customUI/CustomButton"),c=new s,u=!1,h=Ti.UI.createAlertDialog({ok:"Okay",title:"Bang!"}),g={gennaio:"01",febbraio:"02",marzo:"03",aprile:"04",maggio:"05",giugno:"06",luglio:"07",agosto:"08",settembre:"09",ottobre:"10",novembre:"11",dicembre:"12"},T="",m=Titanium.UI.createScrollView({backgroundColor:"#F5F4F2",width:Ti.UI.SIZE,height:Ti.UI.SIZE,layout:"vertical",top:60}),f=Titanium.UI.createLabel({top:5,font:{fontSize:21,fontFamily:"Roboto-Light"},text:String.format(L("duels:chooseWhen"),""),textAlign:"center",color:"#856C64",width:"95%"}),p=Titanium.UI.createLabel({top:5,font:{fontSize:17,fontFamily:"Roboto-LightItalic"},text:"L'ora che imposti sarà calcolata con un intorno di 3 minuti prima e dopo la scadenza per permettere più flessibilità ai partecipanti.",textAlign:"center",color:"#aa938b",width:"95%"}),I=Titanium.UI.createLabel({top:25,font:{fontSize:21,fontFamily:"Roboto-Light"},text:String.format(L("duels:chooseWhere"),""),textAlign:"center",color:"#856C64",width:"95%"}),w=Titanium.UI.createLabel({top:5,font:{fontSize:17,fontFamily:"Roboto-LightItalic"},text:"La posizione che determini sarà calcolata con un raggio di 100 mt rispetto al marker che inserirai sulla mappa.",textAlign:"center",color:"#aa938b",width:"95%"}),b=Titanium.UI.createLabel({top:25,font:{fontSize:21,fontFamily:"Roboto-Light"},text:String.format(L("duels:chooseChallenger"),""),textAlign:"center",color:"#856C64",width:"95%"}),v=Titanium.UI.createLabel({top:5,font:{fontSize:17,fontFamily:"Roboto-LightItalic"},text:"La lista mostrerà i tuoi amici di Facebook che utilizzano Bang! sul proprio dispositivo.",textAlign:"center",color:"#aa938b",width:"95%"}),S={cancel:4,options:["Quick game","Tra 10 minuti","Tra un'ora","Scegli data","Annulla"],title:"Imposta data"},E=Titanium.UI.createView({width:1,height:15,backgroundColor:"#F5F4F2"}),A=Ti.UI.createOptionDialog(S);return A.addEventListener("click",function(e){switch(e.index){case 0:u=!0,n.setTitle("Quick Game"),a.disable();break;case 1:var t=new Date;t.setMinutes(t.getMinutes()+10);var i=t.toLocaleTimeString(),o=i.split(":");n.setTitle(t.toLocaleDateString()+" "+o[0]+":"+o[1]),a.enable(),u=!1;break;case 2:var t=new Date;t.setHours(t.getHours()+1);var i=t.toLocaleTimeString(),o=i.split(":");n.setTitle(t.toLocaleDateString()+" "+o[0]+":"+o[1]),a.enable(),u=!1;break;case 3:A.hide(),Ti.App.fireEvent("show_picker",{}),a.enable(),u=!1}}),n.addEventListener("click",function(){A.show()}),a.addEventListener("click",function(){if(!u){if(Ti.App.fireEvent("close_picker",{}),!Titanium.Network.getOnline()){var e=Ti.UI.createAlertDialog({message:"Il tuo dispositivo sembra non essere connesso ad Internet.",ok:"Okay",title:"Network"});return void e.show()}var t=require("ui/newChallenge/Map"),i=new t;i.open()}}),r.addEventListener("click",function(){if(Ti.App.fireEvent("close_picker",{}),!Titanium.Network.getOnline()){var e=Ti.UI.createAlertDialog({message:"Il tuo dispositivo sembra non essere connesso ad Internet.",ok:"Okay",title:"Network"});return void e.show()}var t=require("ui/newChallenge/FacebookFriends"),i=new t;i.open()}),c.initialize("Conferma",40),m.getDateFromPicker=function(e){n.setTitle(e)},c.addEventListener("click",function(){var e=Ti.UI.createAlertDialog({title:"Crea Duello",message:"Per inserire un duello, devi inserire tutte le informazioni!",ok:"Ho capito"});if(n.getTitle()===String.format(L("duels:whenInstruction"),""))return void e.show();if(u){var t=require("ui/quickGame/QuickGame"),i=new t;i.setIDOpponent(T),Ti.API.info(T),i.open({modal:!0,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_COVER_VERTICAL,modalStyle:Ti.UI.iPhone.MODAL_PRESENTATION_FORMSHEET})}else{loader.showLoader(m);var o=n.getTitle(),a=o.split(" "),r=Ti.Network.createHTTPClient({onload:function(){Ti.API.info("Received text: "+this.responseText);var e=JSON.parse(this.responseText);if(loader.hideLoader(m),0==e.return){h.message="Duello registrato!";var t=a[3].split(":");Ti.API.info(t);var i=t[0];Ti.API.info(i);var o=t[1];o-=5;var n=g[a[1]],r=new Date(a[2],n-1,a[0],i,o,0,0);Ti.App.iOS.scheduleLocalNotification({alertBody:"Un nuovo duello ti aspetta!",badge:1,sound:"music/notification.mp3",userInfo:{id:e.last_id},date:r,category:"DUEL",timezone:"CET"}),Ti.API.info(r.toLocaleString()),h.show(),Ti.App.fireEvent("back",{})}else-2==e.return?(h.message="Inserisci un orario che sia superiore di 15 minuti rispetto all'ultimo inserito!",h.show()):(h.message="Pare ci sia stato un problema. Riprova!",h.show())},onerror:function(e){Ti.API.debug(e.error),loader.hideLoader(m)},timeout:5e3}),s={player_one:Ti.App.Properties.getString("fb_id"),player_two:T,latitude:l,longitude:d,challenge_date:"("+a[2]+"-"+g[a[1]]+"-"+a[0]+" "+a[3]+":00)"};Ti.API.info(JSON.stringify(s)),r.open("GET",global.bangServerUrl+"/challenge-registerChallenge.php?challenge="+JSON.stringify(s)),r.send()}}),Ti.App.addEventListener("friend_choosen",function(e){r.setTitle(e.who),T=e.id}),Ti.App.addEventListener("location_choosen",function(e){a.setTitle("Posizione impostata"),l=e.latitude+"",d=e.longitude+""}),m.add(i),m.add(f),m.add(n),m.add(p),m.add(I),m.add(a),m.add(w),m.add(b),m.add(r),m.add(v),m.add(c),m.add(E),m}module.exports=StartChallengeView;