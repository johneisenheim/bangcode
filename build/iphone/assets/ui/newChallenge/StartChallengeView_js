function StartChallengeView(){var e=require("ui/newChallenge/Picker"),t=(new e,require("ui/customUI/PageTitle")),i=new t;i.initialize("Duello",10);var n=require("ui/customUI/NormalTile"),o=new n;o.initialize(String.format(L("duels:whenInstruction"),""),10,18);var a=new n;a.initialize(String.format(L("duels:whereInstruction"),""),10,18);var r=new n;r.initialize(String.format(L("duels:challengerInstruction"),""),10,18);var l,s,d=require("ui/customUI/CustomButton"),u=new d,c=!1,m=null,T=null,p=!1,h=null,f=null,g=Ti.UI.createAlertDialog({ok:"Okay",title:"Bang!"}),I={gennaio:"01",febbraio:"02",marzo:"03",aprile:"04",maggio:"05",giugno:"06",luglio:"07",agosto:"08",settembre:"09",ottobre:"10",novembre:"11",dicembre:"12"},v="",w=Titanium.UI.createScrollView({backgroundColor:"#F5F4F2",width:Ti.UI.SIZE,height:Ti.UI.SIZE,layout:"vertical",top:60}),S=Titanium.UI.createLabel({top:5,font:{fontSize:21,fontFamily:"Roboto-Light"},text:String.format(L("duels:chooseWhen"),""),textAlign:"center",color:"#856C64",width:"95%"}),A=Titanium.UI.createLabel({top:5,font:{fontSize:17,fontFamily:"Roboto-LightItalic"},text:"L'ora che imposti sarà calcolata con un intorno di 3 minuti prima e dopo la scadenza per permettere più flessibilità ai partecipanti.",textAlign:"center",color:"#aa938b",width:"95%"}),b=Titanium.UI.createLabel({top:25,font:{fontSize:21,fontFamily:"Roboto-Light"},text:String.format(L("duels:chooseWhere"),""),textAlign:"center",color:"#856C64",width:"95%"}),y=Titanium.UI.createLabel({top:5,font:{fontSize:17,fontFamily:"Roboto-LightItalic"},text:"La posizione che determini sarà calcolata con un raggio di 100 mt rispetto al marker che inserirai sulla mappa.",textAlign:"center",color:"#aa938b",width:"95%"}),E=Titanium.UI.createLabel({top:25,font:{fontSize:21,fontFamily:"Roboto-Light"},text:String.format(L("duels:chooseChallenger"),""),textAlign:"center",color:"#856C64",width:"95%"}),P=Titanium.UI.createLabel({top:5,font:{fontSize:17,fontFamily:"Roboto-LightItalic"},text:"La lista mostrerà i tuoi amici di Facebook che utilizzano Bang! sul proprio dispositivo.",textAlign:"center",color:"#aa938b",width:"95%"}),C={cancel:5,options:["Training","Quick game","Tra 10 minuti","Tra un'ora","Scegli data","Annulla"],title:"Imposta data"},_=Titanium.UI.createView({width:1,height:15,backgroundColor:"#F5F4F2"}),D=Ti.UI.createOptionDialog(C);return D.addEventListener("click",function(e){switch(e.index){case 0:p=!0,c=!1,o.setTitle("Training"),a.disable(),r.disable();break;case 1:c=!0,p=!1,o.setTitle("Quick Game"),a.disable(),r.enable();break;case 2:p=!1,c=!1,a.enable(),r.enable();var t=new Date;t.setMinutes(t.getMinutes()+10);var i=t.toLocaleTimeString(),n=i.split(":");o.setTitle(t.toLocaleDateString()+" "+n[0]+":"+n[1]),a.enable(),c=!1;break;case 3:p=!1,c=!1,a.enable(),r.enable();var t=new Date;t.setHours(t.getHours()+1);var i=t.toLocaleTimeString(),n=i.split(":");o.setTitle(t.toLocaleDateString()+" "+n[0]+":"+n[1]),a.enable(),c=!1;break;case 4:p=!1,c=!1,a.enable(),r.enable(),D.hide(),Ti.App.fireEvent("show_picker",{}),a.enable(),c=!1}}),o.addEventListener("click",function(){D.show()}),a.addEventListener("click",function(){if(!c&&!p){if(Ti.App.fireEvent("close_picker",{}),!Titanium.Network.getOnline()){var e=Ti.UI.createAlertDialog({message:"Il tuo dispositivo sembra non essere connesso ad Internet.",ok:"Okay",title:"Network"});return void e.show()}var t=require("ui/newChallenge/Map"),i=new t;i.open()}}),r.addEventListener("click",function(){if(!p){if(Ti.App.fireEvent("close_picker",{}),!Titanium.Network.getOnline()){var e=Ti.UI.createAlertDialog({message:"Il tuo dispositivo sembra non essere connesso ad Internet.",ok:"Okay",title:"Network"});return void e.show()}var t=require("ui/newChallenge/FacebookFriends"),i=new t;i.open()}}),u.initialize("Conferma",40),w.getDateFromPicker=function(e){o.setTitle(e)},u.addEventListener("click",function(){var e=Ti.UI.createAlertDialog({title:"Crea Duello",message:"Per inserire un duello, devi inserire tutte le informazioni!",ok:"Ho capito"});if(o.getTitle()===String.format(L("duels:whenInstruction"),""))return void e.show();if(p)return h=require("ui/training/Training"),f=new h,void f.open({modal:!0,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_COVER_VERTICAL,modalStyle:Ti.UI.iPhone.MODAL_PRESENTATION_FORMSHEET});if(c)if(Ti.API.info(Ti.App.Properties.getBool("remember_quick",1)),Ti.App.Properties.getBool("remember_quick",1)){Ti.API.info("La prop è true");var t=Ti.UI.createAlertDialog({buttonNames:["Si, ricordamelo","No, lo ricorderò"],message:"Dì al tuo avversario di accedere al Quick Game Finder dalla schermata principale. Vuoi che ti ricordi questo messaggio la prossima volta?",title:"Quick Game"});t.addEventListener("click",function(e){switch(e.index){case 0:Ti.App.Properties.setBool("remember_quick",1),m=require("ui/quickGame/QuickGame"),T=new m(!1),T.setIDOpponent(v),Ti.API.info(v),T.open({modal:!0,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_COVER_VERTICAL,modalStyle:Ti.UI.iPhone.MODAL_PRESENTATION_FORMSHEET});break;case 1:Ti.App.Properties.setBool("remember_quick",0),m=require("ui/quickGame/QuickGame"),T=new m(!1),T.setIDOpponent(v),Ti.API.info(v),T.open({modal:!0,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_COVER_VERTICAL,modalStyle:Ti.UI.iPhone.MODAL_PRESENTATION_FORMSHEET})}}),t.show()}else Ti.API.info("La prop è false"),m=require("ui/quickGame/QuickGame"),T=new m(!1),T.setIDOpponent(v),Ti.API.info(v),T.open({modal:!0,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_COVER_VERTICAL,modalStyle:Ti.UI.iPhone.MODAL_PRESENTATION_FORMSHEET});else{loader.showLoader(w);var i=o.getTitle(),n=i.split(" "),a=Ti.Network.createHTTPClient({onload:function(){Ti.API.info("Received text: "+this.responseText);var e=JSON.parse(this.responseText);if(loader.hideLoader(w),0==e.return){g.message="Duello registrato!";var t=n[3].split(":");Ti.API.info(t);var i=t[0];Ti.API.info(i);var o=t[1];o-=5;var a=I[n[1]],r=new Date(n[2],a-1,n[0],i,o,0,0);Ti.App.iOS.scheduleLocalNotification({alertBody:"Un nuovo duello ti aspetta!",badge:1,sound:"music/notification.mp3",userInfo:{id:e.last_id},date:r,category:"DUEL",timezone:"CET"}),Ti.API.info(r.toLocaleString()),g.show(),Ti.App.fireEvent("back",{})}else-2==e.return?(g.message="Inserisci un orario che sia superiore di 15 minuti rispetto all'ultimo inserito!",g.show()):(g.message="Pare ci sia stato un problema. Riprova!",g.show())},onerror:function(e){Ti.API.debug(e.error),loader.hideLoader(w)},timeout:5e3}),r={player_one:Ti.App.Properties.getString("fb_id"),player_two:v,latitude:l,longitude:s,challenge_date:"("+n[2]+"-"+I[n[1]]+"-"+n[0]+" "+n[3]+":00)"};Ti.API.info(JSON.stringify(r)),a.open("GET",global.bangServerUrl+"/challenge-registerChallenge.php?challenge="+JSON.stringify(r)),a.send()}}),Ti.App.addEventListener("friend_choosen",function(e){r.setTitle(e.who),v=e.id}),Ti.App.addEventListener("location_choosen",function(e){a.setTitle("Posizione impostata"),l=e.latitude+"",s=e.longitude+""}),Ti.App.addEventListener("reloadMasterView",function(){e=null,t=null;var e=require("ui/quickGame/QuickGame"),t=new e(!0);t.setIDOpponent(v),Ti.API.info(v),t.open({modal:!0,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_COVER_VERTICAL,modalStyle:Ti.UI.iPhone.MODAL_PRESENTATION_FORMSHEET})}),Ti.App.addEventListener("training_reload",function(){h=null,f=null,h=require("ui/training/Training"),f=new h,f.open({modal:!0,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_COVER_VERTICAL,modalStyle:Ti.UI.iPhone.MODAL_PRESENTATION_FORMSHEET})}),w.add(i),w.add(S),w.add(o),w.add(A),w.add(b),w.add(a),w.add(y),w.add(E),w.add(r),w.add(P),w.add(u),w.add(_),w}module.exports=StartChallengeView;